# 翻译质量评价模块实现方案

## 1. 创建新文件 `translation_scores.py`

该模块将包含以下核心组件：

### 1.1 TranslationScorer 类
- `score_translation()`: 对翻译结果进行多维度评分
- `generate_reference()`: 生成参考译文
- `provide_improvement_suggestions()`: 提供改进建议
- `should_retry()`: 判断是否需要重试

### 1.2 评分维度
- **流畅度(Fluency)**: 0-100分
- **完整性(Completeness)**: 0-100分
- **一致性(Consistency)**: 0-100分
- **准确性(Accuracy)**: 0-100分
- **风格适配(Style Adaptation)**: 0-100分
- **文化适配(Cultural Adaptation)**: 0-100分

### 1.3 评分策略
- 根据翻译模式调整各维度权重
- 幽默风格更重视风格适配和文化适配
- 严肃风格更重视准确性和一致性
- 教育风格更重视流畅度和完整性

## 2. 修改 `ai_services.py`

在 `AIServices` 类中添加：
- `evaluate_translation()`: 评价翻译质量
- `translate_with_retry()`: 带质量评价和重试的翻译方法

## 3. 修改 `main.py`

在视频翻译流程中：
- 在步骤4(文本翻译)后添加质量评价步骤
- 对低分翻译进行重试
- 保存评分结果到文件

## 4. 配置参数

在 `config.py` 中添加：
- `SCORE_THRESHOLD`: 评分阈值(默认70分)
- `MAX_RETRIES`: 最大重试次数(默认2次)
- `SCORING_MODEL`: 评分使用的模型(默认qwen-max)

## 实现细节

### 评分方法
使用LLM作为"评委"，通过精心设计的提示词让模型对翻译结果进行评分。提示词将包含：
1. 评分标准和说明
2. 原文和译文
3. 翻译模式和要求
4. 评分格式要求

### 重试机制
- 如果综合评分低于阈值，触发重试
- 每次重试调整翻译参数(如temperature)
- 记录每次评分，选择最佳结果
- 达到最大重试次数后使用最高分的结果

### 输出格式
评分结果将包含：
- 各维度得分
- 综合得分
- 改进建议
- 是否重试的决策