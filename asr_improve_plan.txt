ASR优化改进计划
================

## 问题分析

### 当前存在的关键问题：

1. **ASR质量评分低（46分）**：识别质量不理想
2. **安全风险**：OSS需要公共读权限
3. **共识机制失效**：3个节点使用同一个Fun-ASR模型，运行3次结果基本一致，失去了"分布式共识"的意义

### 方案评估：

#### ❌ 方案1：按既定prompt重新生成ASR共识部分
- **问题**：只是调整参数和实现细节
- **无法解决**：同一个模型运行3次 = 同一个结果重复3次，共识机制形同虚设

#### ❌ 方案2.1：更改为2-3个ASR模型（独立实现）
- **问题**：
  - 国内ASR服务商（腾讯云、百度云、讯飞）也都要求音频先上传到各自的云存储
  - 成本高：同时调用多个付费API
  - 技术复杂：需要适配3-4种不同的API规范

#### ❌ 方案2.2：维护功能下OSS私有读
- **技术冲突**：Fun-ASR的文件识别API需要长期可访问的公开URL，签名URL有时效性
- **结论**：不可行

#### ❌ 方案2.3：舍弃OSS，音频直接对接ASR API
- **Fun-ASR限制**：文件识别API只接受URL，不支持Base64上传
- **结论**：完全不可行

---

## 优化计划（综合方案）

### 核心思路：优化Fun-ASR单节点 + OSS安全加固 + ASR后处理增强

---

## 阶段一：OSS安全加固 ⚠️ 高优先级（立即执行）

### 目标
降低公共读权限的安全风险

### 实施方案

1. **创建专用OSS Bucket**（独立于现有Bucket）
   - Bucket命名：`video-translate-asr-temp`
   - 用途：仅用于ASR音频临时存储
   - 访问策略：公共读，但限制IP白名单

2. **实施IP白名单策略**
   - Bucket Policy 仅允许阿里云Fun-ASR服务IP访问
   - 降低非授权访问风险

3. **自动清理机制**
   - 音频文件上传时设置生命周期规则（1-2天后自动删除）
   - 识别完成后立即删除临时文件

4. **文件名混淆**
   - 使用UUID随机命名，避免文件名泄露信息
   - 示例：`f"{uuid.uuid4()}.m4a"` 而非 `"{video_title}.m4a"`

### 预期收益
- ✅ 降低安全风险（隔离Bucket + IP白名单 + 自动清理）
- ✅ 维持Fun-ASR功能不变
- ✅ 实施成本低

---

## 阶段二：分布式共识机制重构 🔧 核心优化

### 问题根源
同一个Fun-ASR模型运行3次 = 结果基本一致，共识算法无意义

### 选择方案：方案B（增强型单节点 + 后处理）

#### 实现思路
放弃多模型共识，专注优化单节点质量

#### 优化措施

1. **ASR参数优化**
   ```python
   # 测试不同参数组合
   - language_hints: ["zh", "zh-CN", "en"]  # 语言提示
   - disfluency_removal: True  # 去除语气词
   - vocabulary: ["专业术语词库"]  # 领域词汇
   ```

2. **多轮识别 + 差异对比**
   ```python
   # 同一音频识别2次（非并行，间隔提交）
   # 如果结果差异大 → 质量可能有问题 → 触发重试
   ```

3. **后处理增强**
   - **词典校正**：使用 `dictionaries/` 中的专业词典
   - **上下文校正**：使用LLM修复ASR错误
   - **标点优化**：添加合适的标点符号

#### 优势
- ✅ 成本低（仅Fun-ASR）
- ✅ 实施简单
- ✅ 通过后处理提升质量

#### 风险
- ⚠️ 仍依赖单一模型，无法通过共识发现系统性错误

---

## 阶段三：ASR质量提升专项 📊 针对性优化

### 目标
将46分提升到70+分

### 实施方案

1. **分析历史评分数据**
   - 找出主要错误类型：
     * 逻辑错误？
     * 语义不连贯？
     * 上下文不一致？
     * 识别错误（同音字、漏字）？

2. **针对性修复**
   ```python
   if 主要错误是识别错误:
       优化Fun-ASR参数（vocabulary、language_hints）
       添加词典校正

   if 主要错误是逻辑/语义问题:
       使用LLM后处理修复
       示例prompt："修复这段ASR文本的逻辑错误..."
   ```

3. **自适应阈值**
   - 动态调整ASR_SCORE_THRESHOLD
   - 根据历史评分数据设定合理的重试阈值

---

## 待确认事项

1. **测试视频**：BV1vmmLBpEtz
2. **当前ASR评分**：46分（待验证和详细分析）
3. **优化策略**：
   - 立即执行阶段一（OSS安全加固）
   - 采用方案B（增强型单节点）
   - 本轮不考虑Whisper
   - 重新运行并分析评分

---

## 实施优先级

1. ✅ **立即执行（阶段一）**：OSS安全加固
   - 工作量：小
   - 风险降低：明显
   - 功能影响：无

2. 🔧 **核心优化（阶段二 + 阶段三）**：方案B
   - ASR参数优化
   - 后处理增强
   - 基于实际评分数据的针对性改进

---

*生成时间：2026-01-02*
*当前版本：v1.0*
